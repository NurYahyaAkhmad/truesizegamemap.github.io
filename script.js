// --- 1. HELPER FUNCTIONS & DATA ---
// Update this function at the top of script.js
function processGeoJsonShape(coords, scale = 1.0) {
    let minLat = Infinity, maxLat = -Infinity, minLng = Infinity, maxLng = -Infinity;
    coords.forEach(p => {
        if(p[1] < minLat) minLat = p[1]; if(p[1] > maxLat) maxLat = p[1];
        if(p[0] < minLng) minLng = p[0]; if(p[0] > maxLng) maxLng = p[0];
    });
    const centerLat = (minLat + maxLat) / 2, centerLng = (minLng + maxLng) / 2;
    const R = 6378137, latRad = centerLat * (Math.PI / 180);
    
    return coords.map(p => {
        const dLng = p[0] - centerLng, dLat = p[1] - centerLat;
        // Here we multiply by scale (1.2 for +20%)
        return [
            dLng * (Math.PI / 180) * R * Math.cos(latRad) * scale, 
            dLat * (Math.PI / 180) * R * scale
        ];
    });
}

const rawGtaGeoJson = [
    [120.423097, -6.064046], [120.421443, -6.068683], [120.416265, -6.071664], [120.416537, -6.073426], [120.414221, -6.078439],
    [120.406317, -6.083588], [120.405091, -6.087111], [120.402093, -6.087653], [120.399095, -6.091176], [120.398278, -6.097002],
    [120.395007, -6.097544], [120.393372, -6.100119], [120.397188, -6.102964], [120.397051, -6.107164], [120.394190, -6.110145],
    [120.393645, -6.115700], [120.391737, -6.120036], [120.393645, -6.124778], [120.393100, -6.129927], [120.401548, -6.133856],
    [120.408518, -6.141019], [120.410856, -6.147493], [120.403213, -6.158343], [120.413189, -6.163962], [120.415765, -6.160327],
    [120.414133, -6.159245], [120.417108, -6.152917], [120.422669, -6.156075], [120.423351, -6.161223], [120.434388, -6.161629],
    [120.434116, -6.157565], [120.429755, -6.157294], [120.430573, -6.154449], [120.440111, -6.155262], [120.443109, -6.149843],
    [120.446516, -6.149707], [120.446243, -6.146049], [120.445426, -6.142662], [120.447878, -6.138461], [120.449104, -6.133584],
    [120.448270, -6.129500], [120.450154, -6.126154], [120.449482, -6.122942], [120.448405, -6.121336], [120.449617, -6.113841],
    [120.458905, -6.098314], [120.457290, -6.096440], [120.458636, -6.090416], [120.451770, -6.083191], [120.453788, -6.080382],
    [120.452846, -6.074225], [120.442347, -6.068999], [120.428886, -6.069668], [120.423097, -6.064046]
];

const rawTsushimaGeoJson = [
    [-100.8690236941902, 37.93568779847649], [-100.87279054299572, 37.9309280967816], [-100.87222514838696, 37.92587370225597], 
    [-100.88390497046957, 37.92335525850426], [-100.88710671727843, 37.91874760105655], [-100.88729266653843, 37.91250210016199], 
    [-100.884467840953, 37.91161115340216], [-100.87881730403322, 37.90611249913974], [-100.88465311678989, 37.90120453207753], 
    [-100.88220460651996, 37.89897501054301], [-100.88465082080435, 37.892435136279644], [-100.87824883601102, 37.89169200402142], 
    [-100.88352204891284, 37.88634311977522], [-100.88352070463182, 37.88188429017056], [-100.88069592097798, 37.880398090608], 
    [-100.88126105139395, 37.87133237021612], [-100.87674154048392, 37.87058977931592], [-100.86601023605135, 37.87564257194083], 
    [-100.86167880764737, 37.8670201687374], [-100.86412675497505, 37.85795024590443], [-100.88088686179809, 37.85839723786522], 
    [-100.88390080649928, 37.85467889231302], [-100.88710097422667, 37.85928955128236], [-100.88992504106167, 37.85854668348193], 
    [-100.88766580154146, 37.852152889967385], [-100.890112045123, 37.84873521627395], [-100.88597100793622, 37.84501543258337], 
    [-100.88804252388854, 37.83981043228941], [-100.8876672460785, 37.835941004316794], [-100.88408926980962, 37.835345623102526], 
    [-100.88710372103714, 37.83162430174421], [-100.88390167962882, 37.829840115394944], [-100.88371493344064, 37.823140730653094], 
    [-100.87260177678289, 37.82002024576926], [-100.86657485684002, 37.824771238341455], [-100.86751671109985, 37.826706732496774], 
    [-100.86374921052727, 37.82849032190414], [-100.86544463053507, 37.83488897572299], [-100.86261901584373, 37.835037353698524], 
    [-100.86582139686828, 37.841435418087315], [-100.86393763216306, 37.84069056391564], [-100.86525637253821, 37.84575072641296], 
    [-100.8613007413002, 37.84857626742196], [-100.86393800595583, 37.85021415894926], [-100.86412674974838, 37.85750414349191], 
    [-100.85979487405582, 37.86270715031816], [-100.85923062436967, 37.86746601930575], [-100.85960766249738, 37.86954773886896], 
    [-100.85414807609108, 37.87445340714841], [-100.86469221569692, 37.88173562232453], [-100.86337410962088, 37.8842621347779], 
    [-100.86506864638291, 37.89050383421261], [-100.86713989906734, 37.891989786708095], [-100.86751653130199, 37.89511152412604], 
    [-100.86506849728654, 37.89615187194531], [-100.86356175452062, 37.899868461227726], [-100.86563329169302, 37.902692594238346], 
    [-100.8569686364531, 37.905817270359094], [-100.85489545151732, 37.91250837461291], [-100.85922856652265, 37.91414114055115], 
    [-100.85602587643315, 37.916371836786055], [-100.85508319637535, 37.92127875997758], [-100.85696713180303, 37.92335899949555], 
    [-100.85602439635382, 37.92574016364276], [-100.85866282167143, 37.92424943431769], [-100.8611120271207, 37.92528762292379], 
    [-100.85941586119239, 37.92930496540809], [-100.85602397909385, 37.92886288319556], [-100.8584736118847, 37.930941296809735], 
    [-100.86224189811085, 37.93554423369382], [-100.8690236941902, 37.93568779847649]
];
const rawPubgGeoJson = [
    [-100.85729952128445, 37.92522719281315], [-100.85593003321509, 37.92738672219207], [-100.84536771657726, 37.93111417209889],
    [-100.83978091585023, 37.93111130145839], [-100.83443679256409, 37.92836991459106], [-100.8319531873805, 37.9292511966602],
    [-100.83257281564799, 37.92631258653269], [-100.82971561864701, 37.926900529815], [-100.83084204650822, 37.924250189596975],
    [-100.8339486783181, 37.92140806123996], [-100.83332631378566, 37.919743123693564], [-100.82872831237401, 37.918176433227885],
    [-100.83096388790881, 37.915432810028975], [-100.83108803294331, 37.91396294906045], [-100.8278555516577, 37.91102386999026],
    [-100.83059014373535, 37.908965361991235], [-100.82909754660302, 37.90631960373335], [-100.82636307520984, 37.90484966664316],
    [-100.8278518568673, 37.902105355807976], [-100.83121241788066, 37.900144589959], [-100.82909922514898, 37.898184345317716],
    [-100.82449807948969, 37.89877252660165], [-100.8232573270307, 37.896812013560634], [-100.8235127677848, 37.89436177986664],
    [-100.82190233938019, 37.89279388089781], [-100.8258685090737, 37.8926950633069], [-100.82848941188718, 37.88828610562787],
    [-100.83395861425811, 37.88603321601836], [-100.837306453257, 37.88720797118441], [-100.8371799533096, 37.8894616988983],
    [-100.8427705421292, 37.890148197555376], [-100.84513616508046, 37.88867975983577], [-100.84563441081103, 37.88672045738534],
    [-100.84563817931301, 37.884174273773695], [-100.84426907885354, 37.88436885136434], [-100.84017415750927, 37.882899849585954],
    [-100.83583683853414, 37.878983757653685], [-100.83794849039175, 37.87829865943554], [-100.83732901906626, 37.87741747490287],
    [-100.84104455025823, 37.87133743900746], [-100.84403077967481, 37.87251835727125], [-100.84526767013836, 37.87133918430641],
    [-100.8480043880565, 37.873009663064224], [-100.85010721218481, 37.86957353482582], [-100.85395801685482, 37.87016414514987],
    [-100.85668750408556, 37.868790372276806], [-100.86289591852365, 37.86977280024759], [-100.86537895348137, 37.86908781160342],
    [-100.86935133010077, 37.8713424562725], [-100.87059281650174, 37.873400831842616], [-100.87518540282531, 37.87683131978278],
    [-100.87208306300973, 37.87888957621452], [-100.87208282830026, 37.88026031007573], [-100.86897869261449, 37.88162921337518],
    [-100.86835771952516, 37.883294182898794], [-100.86525572174021, 37.88388327679206], [-100.8657521534669, 37.8848628385155],
    [-100.85830127748285, 37.88701589902308], [-100.85631504087901, 37.88613412930813], [-100.85383282511808, 37.88642833522755],
    [-100.85147771627008, 37.88545020177796], [-100.84973834902675, 37.88574339042036], [-100.84700737053011, 37.88407786783017],
    [-100.84563755164858, 37.884369978322724], [-100.8460068842979, 37.88701442272165], [-100.84799157167423, 37.889463582314136],
    [-100.85097442154877, 37.88848464798279], [-100.85134581240364, 37.89054195335726], [-100.8551970258364, 37.890248766786954],
    [-100.85792903973282, 37.891326731951395], [-100.85768055817083, 37.888877394602744], [-100.86115641807399, 37.88877937419528],
    [-100.86252201312091, 37.8906408580732], [-100.86413583404617, 37.88858343589085], [-100.86959974550331, 37.88740966937516],
    [-100.86860681426225, 37.884862767989176], [-100.86699294839848, 37.88349091667112], [-100.86910315843757, 37.88466666787113],
    [-100.87183254720559, 37.8834884959921], [-100.87717075640363, 37.88280321841437], [-100.8842459791819, 37.88221720786564],
    [-100.88709961944814, 37.88026037870287], [-100.88585811824156, 37.878498377421025], [-100.88635458588342, 37.877518642294035],
    [-100.89181775342307, 37.877808156826916], [-100.8928115423443, 37.88221602961974], [-100.89554397422098, 37.883586367606256],
    [-100.896040008244, 37.88152923610865], [-100.89790354431281, 37.883781711473205], [-100.90013387012615, 37.88447036103133],
    [-100.90187102485837, 37.886331962401854], [-100.9012505134079, 37.88936862301212], [-100.89889048038371, 37.892601569225945],
    [-100.9001339868081, 37.89456003535744], [-100.8970336681532, 37.89632290260283], [-100.89666184281393, 37.89798828489485],
    [-100.89666084158775, 37.907979553553915], [-100.89765398549062, 37.909742588700226], [-100.89306240023946, 37.909352113403585],
    [-100.89008277984911, 37.91052769798827], [-100.88648180832051, 37.909057715098], [-100.88474433016587, 37.911018076050254],
    [-100.8833785640527, 37.911409962167866], [-100.88847007267097, 37.913664368347156], [-100.88971025663166, 37.91042968024327],
    [-100.88859427696529, 37.91376238320666], [-100.89169841867407, 37.91434991551786], [-100.894057514094, 37.91474158029716],
    [-100.90101130140705, 37.920913133526994], [-100.90039032395474, 37.923067953368545], [-100.90163189096293, 37.92463497814141],
    [-100.89592156204446, 37.92502917493243], [-100.89530050344952, 37.923657536691195], [-100.88983649249933, 37.9231675486933],
    [-100.88909152927666, 37.92434331070302], [-100.88164068879733, 37.92277587261961], [-100.87580468595259, 37.924437089389784],
    [-100.86611679723667, 37.92366038248714], [-100.86338516692301, 37.92493283500674], [-100.86152177517371, 37.924149998683816],
    [-100.86003161549573, 37.92630499280821], [-100.85729965412955, 37.925129106587804]
];
const rawFarcry3GeoJson = [
    [-100.87034131944829, 37.8575123919602], [-100.86833454829846, 37.858807930206524], [-100.86395432248825, 37.85852111797722], [-100.86258475407239, 37.85628904204107],
    [-100.85856827029465, 37.85506571639388], [-100.85455265799919, 37.85672321511339], [-100.85117560782736, 37.85593103796822], [-100.85108472619011, 37.85758796887755],
    [-100.84862041174776, 37.85830874079768], [-100.84323636213998, 37.85477806778678], [-100.84278050107059, 37.855498387723955], [-100.84378530730704, 37.85751525710742],
    [-100.8424162637904, 37.85809177898054], [-100.8389473250144, 37.85614705038074], [-100.84141123111296, 37.85463394960189], [-100.84305413600418, 37.85528229810103],
    [-100.84332678401151, 37.85326529525551], [-100.84095357565444, 37.85225666665286], [-100.84040364171767, 37.848221919171934], [-100.84204565509857, 37.84497896829079],
    [-100.84067590788385, 37.842816869066894], [-100.84414395805013, 37.84022211044929], [-100.84715324039387, 37.840510693140544], [-100.84432733000989, 37.842600547329326],
    [-100.84715557609262, 37.84375395693729], [-100.84998264530273, 37.841736159944915], [-100.84970794675544, 37.83993411116293], [-100.85244967817755, 37.83712265420286],
    [-100.85272433386432, 37.83387902091758], [-100.85692331952555, 37.831932939079124], [-100.86002667348411, 37.83243760737025], [-100.8627647850868, 37.83077983670897],
    [-100.8621257746645, 37.828977700714915], [-100.86258214600961, 37.82400382711893], [-100.86586776194359, 37.82126465240438], [-100.86732823183473, 37.821985955436205],
    [-100.87015755390811, 37.8213377647467], [-100.87006628229953, 37.819391407800595], [-100.872895437563, 37.81766215609636], [-100.87627179916349, 37.81737435689344],
    [-100.87928306099559, 37.81535503904827], [-100.88138177889712, 37.81506740211255], [-100.88557869350079, 37.81240214197642], [-100.88676482441193, 37.81305096185656],
    [-100.88676501585704, 37.81535708253354], [-100.88831584068363, 37.81398827866751], [-100.89169198792301, 37.81297874731476], [-100.89342555196146, 37.81319507931883],
    [-100.89360825539946, 37.81542930374732], [-100.89616208772743, 37.81543052756332], [-100.90191204179428, 37.81276161488991], [-100.90583670519723, 37.81463494264787],
    [-100.90528841865712, 37.815861042049534], [-100.90674795287357, 37.81730300094583], [-100.90711091130092, 37.82061984735114], [-100.90647039568496, 37.82436840225249],
    [-100.90820415200564, 37.82523304332378], [-100.90774789672554, 37.82674641579651], [-100.90482792410646, 37.83107018215904], [-100.90181681316348, 37.83330400541645],
    [-100.89944450197252, 37.83330406534533], [-100.89433667820155, 37.83157440670432], [-100.89041481041458, 37.82984419315471], [-100.88895501766484, 37.83013238354698],
    [-100.88941108514567, 37.83142969589136], [-100.88393648734801, 37.83121342950341], [-100.88183826582205, 37.83279835581733], [-100.88019558142288, 37.832366103685686],
    [-100.87937421206804, 37.83085315133506], [-100.87882677501639, 37.832366273829805], [-100.8756331570443, 37.833231278767116], [-100.87389936021032, 37.83085287737478],
    [-100.87234801442037, 37.83150138256194], [-100.86961013981788, 37.83351918079752], [-100.86723712707283, 37.83308658883658], [-100.86495526264949, 37.83106825239351],
    [-100.86285605554542, 37.83077984044321], [-100.86020921999622, 37.83250969310254], [-100.86130449038629, 37.83315843984751], [-100.86194339124117, 37.83640192658892],
    [-100.85929631230309, 37.839861533998544], [-100.86349496635454, 37.839284875564985], [-100.86522913301069, 37.840654181749], [-100.86732840002345, 37.839861344915064],
    [-100.87216550169406, 37.84036559587064], [-100.8748119360405, 37.84259924053961], [-100.87736681087732, 37.842166946311934], [-100.87736681655343, 37.840005161041006],
    [-100.88174691160796, 37.84007743704146], [-100.88439241986853, 37.843319483006425], [-100.88229402726941, 37.845481316065715], [-100.88411856939466, 37.84663360564055],
    [-100.88366213719519, 37.848218151763916], [-100.8850305123469, 37.84987483903225], [-100.88521317539266, 37.852108446447716], [-100.8879495744129, 37.851819294705294],
    [-100.8886791286783, 37.84879347206619], [-100.88639896346567, 37.84706519760911], [-100.88822307932027, 37.84432718639185], [-100.89050324867601, 37.84540744667541],
    [-100.8933310784838, 37.85080989362295], [-100.8948815364215, 37.85102571122994], [-100.89351334669513, 37.85405101029902], [-100.89095967255032, 37.853763601851284],
    [-100.89032109413752, 37.85189079935657], [-100.88995641617542, 37.85426814049265], [-100.8861258456688, 37.85585513715287], [-100.88347996959068, 37.85463066900657],
    [-100.8808339811668, 37.85585518333947], [-100.87827927849088, 37.85441442409339], [-100.87773184685143, 37.856791515713724], [-100.87271369546701, 37.85700772576523],
    [-100.87116241991012, 37.85549546459755], [-100.87170995950616, 37.85765638681657], [-100.86678363774693, 37.85952806130135], [-100.86568853684446, 37.858448040823845],
    // Titik penutup (sama dengan titik awal)
    [-100.87034131944829, 37.8575123919602] 
];
const rawFarcry6GeoJson = [
    [-100.81578997718637, 37.86961102278178], [-100.81177831128254, 37.87113662092074], [-100.81014451790128, 37.87230892436496], [-100.80480267044047, 37.871950763442314],
    [-100.80316933408065, 37.869370924153785], [-100.79663363367712, 37.868785215982925], [-100.79603229207171, 37.866211029645044], [-100.79469059481846, 37.86504159115168],
    [-100.79646758975507, 37.86246509311495], [-100.80048004893719, 37.86117424413098], [-100.80017915693399, 37.85859583389366], [-100.79913631973109, 37.857189535222105],
    [-100.79259910239462, 37.86047390538529], [-100.7905167375199, 37.85871507728068], [-100.78800360463394, 37.86187566696127], [-100.79038337125914, 37.86339887485397],
    [-100.78920465844466, 37.86632465528773], [-100.79083581541875, 37.87301028923977], [-100.78978269058825, 37.87524909051493], [-100.78516661741689, 37.87619514676375],
    [-100.7786311091169, 37.87384700199556], [-100.7756731117951, 37.86668418736757], [-100.76600684486571, 37.861292429936725], [-100.76642590138674, 37.85555225291158],
    [-100.77075007629445, 37.85930250599999], [-100.77371775224013, 37.85813089430437], [-100.77312342648645, 37.85461054738376], [-100.76554592420852, 37.846395503201876],
    [-100.76584640885514, 37.844399923811906], [-100.76777360138527, 37.842874883420436], [-100.7665859043626, 37.84064489011442], [-100.76776732486331, 37.836067855558866],
    [-100.77289274732426, 37.83530474111905], [-100.77593516991831, 37.83759446072976], [-100.77861184321816, 37.83642008928733], [-100.77861338085981, 37.834072320363106],
    [-100.7759371729733, 37.832311433936596], [-100.76998514456162, 37.83184180614539], [-100.76746391416107, 37.82925896715619], [-100.764785996398, 37.82878922450348],
    [-100.76210766027275, 37.8235053065368], [-100.7649390238728, 37.82209718626538], [-100.76434276813787, 37.819161498911654], [-100.76761903611965, 37.816579528812525],
    [-100.76597866627623, 37.811646427822325], [-100.76821547749321, 37.808712932744385], [-100.77103935242629, 37.81035684489463], [-100.77312078927999, 37.80930026569084],
    [-100.77334462400592, 37.806306314119716], [-100.77089202215643, 37.804955746254265], [-100.7694785362666, 37.807479799724334], [-100.76702671901637, 37.80718648826782],
    [-100.76390885862314, 37.801081399125934], [-100.7660107748754, 37.79310676539323], [-100.77538200418464, 37.79100014039348], [-100.78267104389013, 37.792180883564995],
    [-100.78844674277006, 37.79475096564492], [-100.79081974364126, 37.79850504368814], [-100.79751715188056, 37.793231155083205], [-100.79484198554066, 37.79064742609448],
    [-100.79618515318012, 37.788775016692654], [-100.80941033731678, 37.78925200559206], [-100.82603974599499, 37.79205889586326], [-100.82945248529279, 37.797095099087684],
    [-100.82989796160301, 37.80179078927563], [-100.84356866378216, 37.801676484931136], [-100.84119135070887, 37.79979782594077], [-100.84579669477742, 37.79592959997561],
    [-100.86035314319314, 37.79429063354711], [-100.86897021643303, 37.8019179142008], [-100.86778379363832, 37.80860617069061], [-100.86540689425057, 37.81130561648631],
    [-100.86154342152717, 37.80942871170048], [-100.85545283994468, 37.80954589362696], [-100.85782941280135, 37.80555575353729], [-100.8557490633514, 37.80297478137207],
    [-100.85025402510792, 37.80437935212642], [-100.8508486368932, 37.808251999169386], [-100.8495118012221, 37.80930751130502], [-100.84639168193902, 37.805668316202585],
    [-100.84208286098138, 37.80355405358176], [-100.84327150668072, 37.801676367503276], [-100.82974935886409, 37.80190818551354], [-100.8269250487589, 37.80906837936671],
    [-100.8285598646418, 37.81118192670239], [-100.82410144084874, 37.80989012835835], [-100.82335856013951, 37.81317762545842], [-100.82157509862398, 37.811651199994955],
    [-100.81800830844296, 37.81188582522343], [-100.8101315771315, 37.816816447023285], [-100.81206387081596, 37.81998630343095], [-100.81473898607571, 37.81834286705711],
    [-100.81622484888506, 37.8274990137695], [-100.81659673727523, 37.82344940656404], [-100.81964354209398, 37.82174747721875], [-100.81652239161878, 37.8174037294194],
    [-100.81890027762897, 37.816112466910724], [-100.82172419311317, 37.821278025428214], [-100.81889960504287, 37.82609040200798], [-100.82046029586914, 37.82984651452629],
    [-100.82320939224707, 37.830316108929054], [-100.82320901999671, 37.82644252289032], [-100.82781656107865, 37.8250340132186], [-100.8370311011495, 37.82961239416154],
    [-100.84178565280644, 37.827735162477], [-100.84356860357532, 37.82409669025894], [-100.83970550336569, 37.823392096557285], [-100.84356875831617, 37.8208098350739],
    [-100.84609450783125, 37.822922925869406], [-100.84654017105053, 37.825387677406084], [-100.84356857180138, 37.82409674106826], [-100.84178565295534, 37.827617812182936],
    [-100.84698546188322, 37.83031679710257], [-100.84698584896849, 37.83360236193472], [-100.84178566307601, 37.83454108221541], [-100.83821979652868, 37.83841342025205],
    [-100.83331498858485, 37.83653645351029], [-100.8309382905636, 37.83817936948236], [-100.83450504888056, 37.84252058357171], [-100.83747677279908, 37.84111244957086],
    [-100.85099841321005, 37.840995620807234], [-100.85352287326681, 37.83512776947549], [-100.85946498042493, 37.831255529908134], [-100.86169314461156, 37.83606627140861],
    [-100.86748557501355, 37.83278092521594], [-100.86406988716884, 37.83055154215671], [-100.8637728483531, 37.824214977567465], [-100.86703998279992, 37.829143624854325],
    [-100.86704010311207, 37.832898256391175], [-100.86867351453938, 37.834423461932815], [-100.8639212784762, 37.8386474173231], [-100.8671883531179, 37.84193198375337],
    [-100.86986131211924, 37.839937357231264], [-100.86807879798359, 37.84439514682795], [-100.86926585495551, 37.84814810249024], [-100.87000782416389, 37.85119721619226],
    [-100.86852015994417, 37.856121106535184], [-100.86673905511282, 37.85389397540192], [-100.86733124403472, 37.85741037063751], [-100.86272840653949, 37.86081270018951],
    [-100.86287461836247, 37.866320321771], [-100.85752813643425, 37.868430782645106], [-100.85648966479573, 37.86655746618813], [-100.85203226893174, 37.87088985418494],
    [-100.84653758695454, 37.87159282948937], [-100.85054633817865, 37.873113152329054], [-100.8616840874844, 37.8713570149519], [-100.85396195297662, 37.87358406423398],
    [-100.85106601441518, 37.876159798636635], [-100.84579386939481, 37.87638665896576], [-100.84520131126993, 37.871009209989865], [-100.83985487275888, 37.87183019021694],
    [-100.83569601459772, 37.8706610694921], [-100.82782298555856, 37.87277489675387], [-100.81994881241316, 37.87207421812485], [-100.81727562040601, 37.87060748253384],
    [-100.81935276600409, 37.867269347113194], [-100.81608539826846, 37.86644705248882], [-100.81564155360631, 37.869728110265555], 
    // Titik penutup (sama dengan titik awal)
    [-100.81578997718637, 37.86961102278178] 
];
const rawEldenRingGeoJson = [
    [-100.84867819297352, 37.928967616577594], [-100.84965592923535, 37.930584447891874], [-100.84979727106294, 37.932810206284145],
    [-100.8464156941827, 37.93468763273843], [-100.84246126725716, 37.933583151661026], [-100.84217569511536, 37.931141063576774],
    [-100.83498002861624, 37.9302471878315], [-100.82928707618062, 37.93250081744742], [-100.81973106075483, 37.9298088681568],
    [-100.81634569107422, 37.92702370685011], [-100.8176261329615, 37.92367598312043], [-100.81988313231513, 37.92323134600264],
    [-100.8193186811099, 37.92022576611488], [-100.81620857952487, 37.91688939995218], [-100.81804051074609, 37.91299392928924],
    [-100.81676680247183, 37.90976623203511], [-100.81874290691174, 37.90586839225993], [-100.81846170382987, 37.9035292357773],
    [-100.81634788104533, 37.90074407085585], [-100.82326390143177, 37.89773702692362], [-100.82637091995633, 37.89751380565697],
    [-100.83343233310883, 37.892390252545084], [-100.83754168397968, 37.8933241873781], [-100.84665044766174, 37.88981618435672],
    [-100.85630099040937, 37.89290429836613], [-100.86785960420823, 37.893648265428624], [-100.87477915258033, 37.89632247155039],
    [-100.88139050170996, 37.895588193116694], [-100.88421732473707, 37.89172036115778], [-100.88125717877283, 37.88470858455632],
    [-100.88012287082653, 37.87036963655295], [-100.87490708555603, 37.87057745953213], [-100.87308241936528, 37.87250103472071],
    [-100.86376957086537, 37.87124051091793], [-100.85681721118509, 37.87318739429071], [-100.85256817035855, 37.87689618437136],
    [-100.8465682227622, 37.876808307467414], [-100.84389079537615, 37.874806067666285], [-100.84050684751257, 37.875251021504155],
    [-100.83881392350665, 37.87769881422335], [-100.84149658954806, 37.87847958930885], [-100.8430419436617, 37.88148190328256],
    [-100.84233060310406, 37.883038284589006], [-100.83837973181059, 37.883149255359925], [-100.83457524999135, 37.880255803547655],
    [-100.83325326808836, 37.876114895401685], [-100.83571281396507, 37.87348832520415], [-100.83442457491586, 37.871993792871436],
    [-100.8320383988568, 37.87201872593742], [-100.83118936997707, 37.87056989209397], [-100.83160117280774, 37.865662790973886],
    [-100.83837457202333, 37.862322372107414], [-100.83696339884315, 37.86020569601466], [-100.83992682118637, 37.85864705056966],
    [-100.84387576038418, 37.860650102482], [-100.84599203929572, 37.85987021926819], [-100.84810783159003, 37.861540093494185],
    [-100.85163580388134, 37.86120716507352], [-100.85403508150046, 37.86310273755335], [-100.8550239395402, 37.866001927433544],
    [-100.85798657574887, 37.86745106814152], [-100.8598198739932, 37.86332891468692], [-100.85699790333679, 37.861098502856464],
    [-100.86165368336432, 37.85920863705222], [-100.86334640970573, 37.85687108370537], [-100.86066604564061, 37.855196826131916],
    [-100.86221766001334, 37.84884433838367], [-100.87056888954723, 37.842941002979444], [-100.87096397774468, 37.84695482333677],
    [-100.86856591645335, 37.84940483039321], [-100.86919443466927, 37.8511688821051], [-100.87124588299102, 37.85130021072591],
    [-100.87181013129347, 37.84951805777095], [-100.8749130761323, 37.849074038358665], [-100.8781572316354, 37.85107928000852],
    [-100.87858031220536, 37.854086627405394], [-100.87378446235816, 37.85542309979404], [-100.87152751762446, 37.85776216312813],
    [-100.87223219154458, 37.860102860269635], [-100.87477093082482, 37.859546162451394], [-100.87730757911426, 37.86211148275535],
    [-100.87801131763196, 37.86511969912188], [-100.88167629225, 37.86601174425597], [-100.8828680145332, 37.871023144027504],
    [-100.8850613583885, 37.86667840819612], [-100.88633080123047, 37.86745722407012], [-100.88709816902552, 37.873111480998574],
    [-100.89245843498566, 37.87405385482303], [-100.89492844147664, 37.872245604284416], [-100.90127685608591, 37.872466526911865],
    [-100.90536190267531, 37.869767795832985], [-100.90848043706755, 37.871638828964464], [-100.90709873489179, 37.8772304927796],
    [-100.9068131619051, 37.888781840362], [-100.90869258316212, 37.8912866810704], [-100.90561463823833, 37.89470196853418],
    [-100.90466787757698, 37.89773015563698], [-100.90678531936318, 37.89895479229243], [-100.90651057616604, 37.90185058491103],
    [-100.90047344446522, 37.90659212603032], [-100.89627146136412, 37.90507405281032], [-100.89394516490759, 37.903806494616745],
    [-100.89186280657162, 37.90172146961734], [-100.89604392357488, 37.89678199822271], [-100.89966562924829, 37.89730880996872],
    [-100.90285690100139, 37.89075333647209], [-100.90235409185436, 37.88436218758], [-100.90123219915485, 37.878396685708495],
    [-100.89472574530083, 37.87910557125521], [-100.88362875149387, 37.8724975472614], [-100.88703676789405, 37.8812587263715],
    [-100.88790600103773, 37.887593696278984], [-100.8914931249519, 37.89059733709112], [-100.89217090704003, 37.89257170239168],
    [-100.89507857332656, 37.89222258137265], [-100.89801966351375, 37.89418315730582], [-100.8950003098808, 37.89719044303888],
    [-100.89010993150795, 37.90318459654226], [-100.8927424600096, 37.906256926965554], [-100.89563689951058, 37.905092124150144],
    [-100.9001193347427, 37.90742673467676], [-100.89776366114131, 37.9127567392721], [-100.8942447842909, 37.91323728732134],
    [-100.89269032433903, 37.914986662461516], [-100.89053798721308, 37.91611478089703], [-100.88770147008626, 37.9149709396487],
    [-100.88635807026071, 37.912950462476346], [-100.88227987198563, 37.91393911044348], [-100.88131158994702, 37.916686180004845],
    [-100.88450807048733, 37.917435482264835], [-100.88483134210148, 37.91949034969561], [-100.88112363529457, 37.92066572158183],
    [-100.87759637947322, 37.91999791523685], [-100.87590264057154, 37.92144299441482], [-100.87731102410277, 37.92444122403175],
    [-100.87420886201211, 37.9312328196696], [-100.86898930594559, 37.93089976483141], [-100.86800176086574, 37.93301359869166],
    [-100.8561498152217, 37.93157699974418], [-100.85053857177566, 37.928133822154535], [-100.84852717629366, 37.92891353095398]
];
const rawTheForestGeoJson = [
    [-100.877285,37.854304],[-100.865348,37.854363],[-100.865386,37.853817],[-100.865479,37.853375],
    [-100.865031,37.852829],[-100.864900,37.851738],[-100.864527,37.851472],[-100.864527,37.851148],
    [-100.864938,37.850779],[-100.864881,37.850336],[-100.864695,37.849938],[-100.864807,37.849614],
    [-100.864620,37.849097],[-100.864956,37.848227],[-100.865759,37.847372],[-100.866208,37.847180],
    [-100.866395,37.847018],[-100.865928,37.847003],[-100.865703,37.846767],[-100.865834,37.846546],
    [-100.867123,37.844997],[-100.868617,37.844289],[-100.870579,37.844200],[-100.871195,37.844363],
    [-100.871289,37.844849],[-100.871905,37.845439],[-100.872746,37.845469],[-100.873157,37.845130],
    [-100.873455,37.844386],[-100.873867,37.844451],[-100.873904,37.845277],[-100.874072,37.845528],
    [-100.873736,37.845897],[-100.874539,37.846501],[-100.875286,37.846811],[-100.875380,37.847180],
    [-100.875038,37.847528],[-100.875233,37.847684],[-100.875703,37.847553],[-100.876015,37.847785],
    [-100.875865,37.848227],[-100.875174,37.848611],[-100.874950,37.849171],[-100.874072,37.849363],
    [-100.873213,37.849451],[-100.872764,37.850189],[-100.873045,37.850469],[-100.874744,37.850277],
    [-100.875791,37.850720],[-100.875996,37.851369],[-100.876351,37.851974],[-100.876874,37.852416],
    [-100.876781,37.852755],[-100.876967,37.852962],[-100.877005,37.853493],[-100.876612,37.853906],
    [-100.877304,37.853729],[-100.877301,37.854296]
];
const gamesData = [
    { id: 'gta_v', name: 'Grand Theft Auto V', description: 'Los Santos', size: '~75 km²', color: '#2f89a5ff', image: 'gtav.jpg', shape: processGeoJsonShape(rawGtaGeoJson, 1.1) },
    { 
        id: 'ghost_tsushima', 
        name: 'Ghost of Tsushima', 
        description: 'Tsushima Island', 
        size: '~29 km²', 
        color: '#423b36ff', // Samurai red
        image: 'got.jpg', // Make sure you have this image file
        shape: processGeoJsonShape(rawTsushimaGeoJson, 0.9) 
    },
    { 
        id: 'pubg', 
        name: 'PUBG ', 
        description: 'Erangel', 
        size: '~64 km²', 
        color: '#0e6692ff', // PUBG gold/orange
        image: 'erangel.jpg', // Make sure you have this image file
        shape: processGeoJsonShape(rawPubgGeoJson, 1.0) 
    },
    {
        id: 'farcry3',
        name: 'Far Cry 3',
        size: '~30 km²',
        description: 'Rook Islands',
        image: 'farcry3.jpg', // Make sure image exists in images folder
        color: '#2f5826ff', // Yellow/Gold
        shape: processGeoJsonShape(rawFarcry3GeoJson, 1.0)
    },
    {
        id: 'farcry6',
        name: 'Far Cry 6',
        size: '~88 km²',
        description: 'Yara',
        image: 'farcry6.jpg', // Make sure farcry6.webp is available
        color: '#94840bff', // Revolution theme color
        shape: processGeoJsonShape(rawFarcry6GeoJson, 1.0)
    },
    {   id: 'elden_ring', name: 'Elden Ring', 
        description: 'The Lands Between', 
        size: '~79 km²', color: '#f59e0b', 
        image: 'elden.jpg', 
        shape: processGeoJsonShape(rawEldenRingGeoJson) 
    },
    { 
        id: 'the_forest', 
        name: 'The Forest', 
        description: 'The Peninsula', 
        size: '~10 km²', // Estimated playable area
        color: '#1e8023ff', // Forest green
        image: 'theforest.jpg', // Make sure you have this image
        shape: processGeoJsonShape(rawTheForestGeoJson, 1.0) 
    },
];


// --- 2. MAP SETUP & LOGIC ---
const map = L.map('map', { zoomControl: false }).setView([40.45, -73.8],11); // Meningkatkan latitude dari 40.28 ke 40.38

// ... baris L.control.zoom dan L.tileLayer biarkan saja (tidak perlu diubah) ...
L.control.zoom({ position: 'bottomright' }).addTo(map);
L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap &copy; CARTO', subdomains: 'abcd', maxZoom: 19
}).addTo(map);

let activeLayers = [];

function getLatLngFromMeters(center, dx, dy) {
    const R = 6378137, latRad = center.lat * (Math.PI / 180);
    const dLat = (dy / R) * (180 / Math.PI), dLng = (dx / (R * Math.cos(latRad))) * (180 / Math.PI);
    return L.latLng(center.lat + dLat, center.lng + dLng);
}

function getCoordsFromMeters(center, shape) {
    const R = 6378137, latRad = center.lat * (Math.PI / 180);
    return shape.map(p => {
        const dLat = (p[1] / R) * (180 / Math.PI), dLng = (p[0] / (R * Math.cos(latRad))) * (180 / Math.PI);
        return [center.lat + dLat, center.lng + dLng];
    });
}

function spawnGameMap(game) {
    if (activeLayers.some(l => l.gameId === game.id)) return;
    if(window.innerWidth <= 768) toggleSidebar();

    const polyCenter = map.getCenter();
    let maxX = -Infinity, minY = Infinity;
    game.shape.forEach(([x, y]) => { if(x > maxX) maxX = x; if(y < minY) minY = y; });
    
    const handleLatLng = getLatLngFromMeters(polyCenter, maxX, minY);
    const dragHandle = L.marker(handleLatLng, {
        draggable: true, icon: L.divIcon({ className: 'drag-handle-icon', html: '<i class="fas fa-arrows-alt"></i>', iconSize: [30, 30], iconAnchor: [15, 15] })
    }).addTo(map);

    const polygon = L.polygon(getCoordsFromMeters(polyCenter, game.shape), { color: game.color, fillColor: game.color, fillOpacity: 0.5, weight: 2 }).addTo(map);
    const uId = Date.now();
    
    polygon.bindPopup(`<div class="popup-content"><span class="popup-title">${game.name}</span><br>Size: ${game.size}<br><button class="btn-remove-single" onclick="removeSingleLayer(${uId}, '${game.id}')">Remove</button></div>`);

    dragHandle.on('drag', (e) => {
        const newCenter = getLatLngFromMeters(e.latlng, -maxX, -minY);
        polygon.setLatLngs(getCoordsFromMeters(newCenter, game.shape));
    });

    activeLayers.push({ id: uId, gameId: game.id, handle: dragHandle, poly: polygon });
    updateListUI();
}

window.removeSingleLayer = (id, gameId) => {
    const idx = activeLayers.findIndex(l => l.id === id);
    if (idx > -1) { map.removeLayer(activeLayers[idx].handle); map.removeLayer(activeLayers[idx].poly); activeLayers.splice(idx, 1); updateListUI(); }
}

window.resetAllMaps = () => {
    activeLayers.forEach(l => { map.removeLayer(l.handle); map.removeLayer(l.poly); });
    activeLayers = []; updateListUI();
}

window.filterGames = () => {
    const input = document.getElementById('searchInput').value.toLowerCase();
    const cards = document.getElementsByClassName('game-card');
    Array.from(cards).forEach(c => c.style.display = c.innerText.toLowerCase().includes(input) ? "flex" : "none");
}

window.toggleSidebar = () => {
    const sb = document.getElementById('sidebar'), btn = document.getElementById('sidebar-toggle-btn'), icon = document.getElementById('toggleIcon');
    sb.classList.toggle('collapsed'); btn.classList.toggle('collapsed');
    icon.className = sb.classList.contains('collapsed') ? 'fas fa-chevron-right' : 'fas fa-chevron-left';
    setTimeout(() => map.invalidateSize(), 300);
}

function updateListUI() {
    gamesData.forEach(g => {
        const card = document.getElementById('card-' + g.id);
        const isActive = activeLayers.some(l => l.gameId === g.id);
        
        if (isActive) {
            card.classList.add('disabled');
        } else {
            card.classList.remove('disabled');
        }
    });
}

const listContainer = document.getElementById('gameList');
gamesData.forEach(game => {
    const el = document.createElement('div');
    el.className = 'game-card'; el.id = 'card-' + game.id;
    el.style.setProperty('--game-bg-image', `url('${game.image}')`);
    el.innerHTML = `<div class="game-info"><span class="game-title">${game.name}</span><span class="game-description">${game.description}</span></div><span class="game-size" style="border:1px solid ${game.color}; color:${game.color}">${game.size}</span>`;
    
    el.onclick = () => {
        const activeLayer = activeLayers.find(l => l.gameId === game.id);
        if (activeLayer) {
            removeSingleLayer(activeLayer.id, game.id);
        } else {
            spawnGameMap(game);
        }
    };
    
    listContainer.appendChild(el);
});

// --- NEW LOGIC FOR INFO MODAL (ABOUT & PRIVACY) ---

const modalContentData = {
    about: {
        title: "About the App",
        body: `
            <p><strong>True Size Of Game Maps</strong> is an interactive visualization tool that lets you compare the real-world size (true size) of video game maps on a world map.</p>
            
            <p>This app was created for educational and entertainment purposes, offering a new perspective on how large your favorite virtual worlds are compared to real-world locations.</p>

            <p>Developed by <strong>Nur Yahya Akhmad</strong> using <strong>LeafletJS</strong> and <strong>OpenStreetMap</strong>. 
            Inspired by <a href="https://thetruesize.com/" target="_blank" rel="noopener">The True Size Of...</a>, Yahya brings a game-map themed experience.</p>
        `
    },
    privacy: {
        title: "Privacy Policy",
        body: `
            <p><strong>Privacy Policy:</strong></p>
            <p>1. This application runs entirely on the client side (your browser).</p>
            <p>2. We <strong>do not collect</strong>, store, or share your personal location data.</p>
            <p>3. This app does not use tracking cookies for advertising purposes.</p>
            <p>4. All map interactions are local and temporary and will be cleared when you close this page.</p>
        `
    }
};

window.openInfoModal = (type) => {
    const modal = document.getElementById('infoModalOverlay');
    const title = document.getElementById('modalTitle');
    const body = document.getElementById('modalContent');
    
    if (modalContentData[type]) {
        title.innerHTML = modalContentData[type].title;
        body.innerHTML = modalContentData[type].body;
        modal.classList.add('active');
    }
}

window.closeInfoModal = (e) => {
    // Close if the clicked element is the overlay (dark area) or the close button
    if (e.target.id === 'infoModalOverlay' || e.target.classList.contains('modal-close-btn')) {
        document.getElementById('infoModalOverlay').classList.remove('active');
    }
}
function initDefaultState() {
    // 1. Ambil data game GTA V dari array gamesData
    const gtaData = gamesData.find(g => g.id === 'gta_v');
    
    if (gtaData) {
        // 2. Spawn Map GTA V
        // Karena view peta saat ini sedang di laut (lihat langkah 1), 
        // maka GTA V akan muncul tepat di tengah laut tersebut.
        spawnGameMap(gtaData);

        // 3. Geser Kamera ke Kota New York
        // Setelah map muncul, kita geser pandangan (pan) ke atas dan kiri 
        // supaya terlihat New York City di kiri atas dan GTA V di kanan bawah.
        setTimeout(() => {
            map.flyTo([40.65, -73.95], 10, { // Meningkatkan latitude dari 40.55 ke 40.65
                animate: true,
                duration: 1.5
            });
        }, 500); // Beri jeda sedikit agar map ter-render dulu
    }
}

// Jalankan fungsi inisialisasi
initDefaultState();